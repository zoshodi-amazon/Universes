# ===============================================================================
# LABS/TUI - Domain-Agnostic Workbench Framework
# ===============================================================================
#
# NAME
#     justfile - Universal Lab TUI framework
#
# SYNOPSIS
#     just <recipe> [arguments...]
#     just --list
#
# DESCRIPTION
#     Domain-agnostic Lab framework with 8 core capabilities:
#
#     STORAGE   - SQLite persistence with full history
#     METRICS   - Artifact measurement and comparison
#     LOGS      - Observability and debugging
#     PREVIEW   - Live visualization
#     KNOBS     - Orthogonal transform controls
#     SESSION   - Workspace state management
#     PRESETS   - Zoo hierarchy (global/domain/user)
#     LAYOUT    - Tmux pane presets
#
# ===============================================================================

scripts := "Universe"

default:
    @just --list

# -------------------------------------------------------------------------------
# STORAGE
# -------------------------------------------------------------------------------

# Initialize storage
# ARGS: path - database path (default: .lab/library.db)
init-storage path=".lab/library.db":
    @gum style --border normal --padding "0 1" "Initializing storage..."
    @nu {{scripts}}/Storage/Bindings/Scripts/default.nu '{"action": "init", "db_path": "{{path}}"}'

# Add artifact to storage
# ARGS: name - display name, file - file path, source - url/file/generated
add name file source="file":
    @gum style --border normal --padding "0 1" "Adding: $(gum style --foreground 212 '{{name}}')..."
    @nu {{scripts}}/Storage/Bindings/Scripts/default.nu '{"action": "add", "name": "{{name}}", "path": "{{file}}", "source": "{{source}}"}'

# List all artifacts
list:
    @nu {{scripts}}/Storage/Bindings/Scripts/default.nu '{"action": "list"}'

# Show history
history:
    @nu {{scripts}}/Storage/Bindings/Scripts/default.nu '{"action": "history"}'

# -------------------------------------------------------------------------------
# METRICS
# -------------------------------------------------------------------------------

# Show metrics summary
metrics:
    @nu {{scripts}}/Metrics/Bindings/Scripts/default.nu '{"action": "summary"}'

# Compare two artifacts
# ARGS: baseline - baseline ID, target - target ID
compare baseline target:
    @nu {{scripts}}/Metrics/Bindings/Scripts/default.nu '{"action": "compare", "baseline": "{{baseline}}", "target": "{{target}}"}'

# -------------------------------------------------------------------------------
# LOGS
# -------------------------------------------------------------------------------

# Watch files and run command on change
# ARGS: patterns - glob patterns, command - command to run
watch patterns command:
    @gum style --border normal --padding "0 1" "Watching: $(gum style --foreground 212 '{{patterns}}')..."
    @nu {{scripts}}/Logs/Bindings/Scripts/default.nu '{"patterns": ["{{patterns}}"], "command": "{{command}}"}'

# -------------------------------------------------------------------------------
# PREVIEW
# -------------------------------------------------------------------------------

# Launch interactive preview
# ARGS: domain - lab domain (audio, video, 3d, data)
preview domain="audio":
    @nu {{scripts}}/Preview/Bindings/Scripts/default.nu '{"domain": "{{domain}}"}'

# -------------------------------------------------------------------------------
# KNOBS
# -------------------------------------------------------------------------------

# List knobs with current values
knobs:
    @nu {{scripts}}/Knobs/Bindings/Scripts/default.nu '{"action": "list"}'

# -------------------------------------------------------------------------------
# SESSION
# -------------------------------------------------------------------------------

# Initialize session
init-session:
    @gum style --border normal --padding "0 1" "Initializing session..."
    @nu {{scripts}}/Session/Bindings/Scripts/default.nu '{"action": "init"}'

# Show session state
session:
    @nu {{scripts}}/Session/Bindings/Scripts/default.nu '{"action": "load"}'

# Set current artifact
# ARGS: id - artifact ID
current id:
    @nu {{scripts}}/Session/Bindings/Scripts/default.nu '{"action": "set-current", "id": "{{id}}"}'

# -------------------------------------------------------------------------------
# PRESETS
# -------------------------------------------------------------------------------

# List all presets
presets:
    @nu {{scripts}}/Presets/Bindings/Scripts/default.nu '{"action": "list"}'

# Save current knobs as preset
# ARGS: name - preset name
save-preset name:
    @nu {{scripts}}/Presets/Bindings/Scripts/default.nu '{"action": "save", "name": "{{name}}"}'

# Load preset
# ARGS: name - preset name
load-preset name:
    @nu {{scripts}}/Presets/Bindings/Scripts/default.nu '{"action": "load", "name": "{{name}}"}'

# -------------------------------------------------------------------------------
# SOURCES
# -------------------------------------------------------------------------------

# List configured remote sources
sources:
    @nu {{scripts}}/Sources/Bindings/Scripts/default.nu '{"action": "list"}'

# Browse a remote source interactively
browse source="":
    @nu {{scripts}}/Sources/Bindings/Scripts/default.nu '{"action": "browse", "name": "{{source}}"}'

# Fetch asset from source
# ARGS: source - source name, file - filename
fetch source file:
    @nu {{scripts}}/Sources/Bindings/Scripts/default.nu '{"action": "fetch", "source": "{{source}}", "file": "{{file}}"}'

# -------------------------------------------------------------------------------
# LAYOUT
# -------------------------------------------------------------------------------

# Set tmux layout preset
# ARGS: preset - explore/compare/export/monitor
layout preset="explore":
    @nu {{scripts}}/Layout/Bindings/Scripts/default.nu '{"preset": "{{preset}}"}'
