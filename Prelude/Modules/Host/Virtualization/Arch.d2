# Virtualization Architecture

direction: down

title: {
  label: Virtualization Module
  shape: text
  style.font-size: 20
}

# Global Duality
global: Global Duality {
  style.fill: "#e1f5fe"
  
  env: Env {
    aggregates: "Universe/*/Options"
  }
  
  instances: Instances {
    lima: "flake.modules.homeManager.lima"
    microvm: "flake.modules.nixos.microvm"
  }
  
  env -> instances: config
}

# Universe
universe: Universe {
  style.fill: "#fff3e0"
  
  lima: Lima (macOS) {
    options: Options {
      enable: enable
    }
    bindings: Bindings
    options -> bindings
  }
  
  microvm: MicroVM (NixOS) {
    options: Options {
      enable: enable
      memory: memory
      vcpu: vcpu
    }
    bindings: Bindings {
      scripts: Scripts
    }
    options -> bindings
  }
}

# Flow
global.env -> universe: reads
universe -> global.instances: exports

# VMs
vms: Virtual Machines {
  style.fill: "#e8f5e9"
  shape: cloud
}

global.instances -> vms: runs
